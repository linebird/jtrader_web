<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Multi-Strategy Backtest Dashboard</title>
    {{ resources | safe }}
    <style>
        body { margin: 0; font-family: sans-serif; background-color: #f8f9fa; }
        header { 
            background-color: #2c3e50; color: white; padding: 10px 20px; 
            display: flex; justify-content: space-between; align-items: center; 
        }
        .search-form { display: flex; gap: 12px; align-items: center; }
        .search-form div { display: flex; flex-direction: column; }
        label { font-size: 0.7rem; color: #bdc3c7; margin-bottom: 2px; }
        input, select { padding: 5px; border-radius: 4px; border: none; font-size: 0.9rem; }
        button { 
            padding: 8px 15px; background-color: #27ae60; color: white; border: none; 
            border-radius: 4px; cursor: pointer; font-weight: bold; margin-top: 12px;
        }
        .stats-bar { display: flex; justify-content: space-around; background: white; padding: 10px; border-bottom: 1px solid #ddd; }
        .stat-value { font-weight: bold; color: #27ae60; font-size: 1.1rem; }
        /* 마우스 호버 효과 추가 */
        header a:hover {
            color: white !important;
            border-color: #27ae60 !important;
            background-color: #27ae60;
        }
    </style>
</head>
<body>

    <header>
        <div style="display: flex; align-items: left; gap: 20px;">
            <div style="font-size: 1.4rem; font-weight: bold; cursor: pointer;" onclick="location.href='{{ url_for('stock.index') }}'">
                K-Stock Insight
            </div>
            <!-- [추가] 종목 필터링 이동 링크 -->
            <a href="{{ url_for('ticker.ticker_list') }}" 
            style="color: #bdc3c7; text-decoration: none; font-size: 0.9rem; border: 1px solid #455a64; padding: 5px 12px; border-radius: 4px; transition: 0.3s;">
            종목 필터링(검색) →
            </a>
        </div>
        
        <form method="POST" class="search-form">
            <div>
                <label>전략 선택</label>
                <select name="strategy">
                    <option value="macd" {% if strategy == 'macd' %}selected{% endif %}>MACD 전략</option>
                    <option value="slope" {% if strategy == 'slope' %}selected{% endif %}>이평선 기울기</option>
                    <option value="pullback" {% if strategy == 'pullback' %}selected{% endif %}>20일선 눌림목</option>
                    <option value="cross" {% if strategy == 'cross' %}selected{% endif %}>골든크로스(5/20)</option>
                    <option value="sr_flip" {% if strategy == 'sr_flip' %}selected{% endif %}>S/R Flip (돌파&리테스트)</option>
                    <option value="rsi" {% if strategy == 'rsi' %}selected{% endif %}>RSI 과매도/과매수</option>
                    <option value="rsi_div" {% if strategy == 'rsi_div' %}selected{% endif %}>RSI 다이버전스</option>
                    <option value="rsi_support" {% if strategy == 'rsi_support' %}selected{% endif %}>RSI 40-50 지지(상승장)</option>
                    <option value="adx" {% if strategy == 'adx' %}selected{% endif %}>ADX 전략</option>
                    <option value="v_breakout" {% if strategy == 'v_breakout' %}selected{% endif %}>변동성 돌파(래리 윌리엄스)</option>
                    <option value="fibonacci" {% if strategy == 'fibonacci' %}selected{% endif %}>피보나치 되돌림(0.382-0.618)</option>
                    <option value="complex" {% if strategy == 'complex' %}selected{% endif %}>복합 전략</option>
                </select>
            </div>
            <div>
                <label>종목코드</label>
                <input type="text" name="ticker" value="{{ ticker }}" style="width: 70px;">
            </div>
            <div>
                <label>시작일</label>
                <input type="date" name="from_date" value="{{ from_date }}">
            </div>
            <div>
                <label>종료일</label>
                <input type="date" name="to_date" value="{{ to_date }}">
            </div>
            <button type="submit">테스트 실행</button>
        </form>
    </header>

    {% if stats %}
    <div class="stats-bar">
        <div>수익률: <span class="stat-value">{{ stats.Return }}</span></div>
        <div>승률: <span class="stat-value">{{ stats.WinRate }}</span></div>
        <div>거래횟수: <span class="stat-value">{{ stats.Trades }}</span></div>
    </div>
    {% endif %}

    <div style="width: 100%;">
        {{ div | safe }}
    </div>

    {{ script | safe }}

</body>
</html>